import{getObjectFields as a,is as D,SuiObjectData as R}from"@mysten/sui.js";import c from"lodash-es/has.js";import p from"lodash-es/get.js";import{ipfsConversion as b}from"../lib/getWalletContents.js";const d=/(0x[a-f0-9]{39,40})::nft::Nft<0x[a-f0-9]{39,40}::([a-zA-Z]{1,})::([a-zA-Z]{1,})>/,j=/0x0000000000000000000000000000000000000000000000000000000000000002::dynamic_field::Field<(0x[a-f0-9]{39,40})::utils::Marker<(0x[a-f0-9]{39,40})::display::UrlDomain>, (0x[a-f0-9]{39,40})::display::UrlDomain>/,x=/0x0000000000000000000000000000000000000000000000000000000000000002::dynamic_field::Field<(0x[a-f0-9]{39,40})::utils::Marker<(0x[a-f0-9]{39,40})::display::DisplayDomain>, (0x[a-f0-9]{39,40})::display::DisplayDomain>/,f="reference.objectId",g="data.fields.bag.fields.id.id",m="data.fields.logical_owner",_={parser:(t,e,s)=>{if(typeof s.data=="object"&&"owner"in s.data){const{owner:n}=s.data,i=e.content.type.match(d);if(!i)return;const l=i[1],o=i[2],r=i[3];return{owner:n,type:e.content?.dataType,id:s.data.objectId,packageObjectId:l,packageModule:o,packageModuleClassName:r,rawResponse:s,logicalOwner:t.logical_owner,bagId:t.bag.fields.id.id}}},regex:d},u=(t,e)=>{const{data:s}=t;if(D(s,R)){const{content:n}=s;if(n&&"type"in n)return n.type.match(e)}return!1},O=t=>{const e={},s=t.find(i=>u(i,j)),n=t.find(i=>u(i,x));if(s&&a(s)){const i=a(s).value.fields.url;e.url=b(i)}return n&&a(n)&&(e.description=a(n).value.fields.description,e.name=a(n).value.fields.name),e},w=t=>!!t.content&&"fields"in t.content&&"logical_owner"in t.content.fields&&"bag"in t.content.fields,I=async(t,e)=>{if(!w(e)||!c(e,f)||!c(e,g)||!c(e,m))return e;const s=p(e,f),n=p(e,g),i=p(e,m),o=(await t.getDynamicFields({parentId:n||""})).data.map(y=>y.objectId),r=await t.multiGetObjects({ids:o,options:{showContent:!0,showDisplay:!0,showOwner:!0,showType:!0}});return{id:s,owner:i,...O(r)}};var F=I;export{_ as NftParser,F as default,w as isBagNFT,O as parseDomains};
