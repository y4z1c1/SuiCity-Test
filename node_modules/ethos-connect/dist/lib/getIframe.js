import a from"store2";import b from"./getConfiguration.js";import u from"./log.js";import x from"./postIFrameMessage.js";const I=p=>{const{apiKey:i,walletAppUrl:r,network:w}=b();if(u("getIframe","getIframe",i,r),!i||!r)return;const d="ethos-wallet-iframe";let c=0,e=document.getElementById(d);const f=()=>{!e||(e.style.width="1px",e.style.height="1px")},s=new URLSearchParams(window.location.search),m=s.get("access_token"),h=s.get("refresh_token");let o=r+`/wallet?apiKey=${i}&network=${w}`;if(m&&h){o+=`&access_token=${m}&refresh_token=${h}`,s.delete("access_token"),s.delete("refresh_token");let t=location.protocol+"//"+location.host+location.pathname;s.toString().length>0&&(t+="?"+s.toString()),a.namespace("auth")("access_token",m),a.namespace("auth")("refresh_token",h),window.history.pushState({},"",t)}else{const t=a.namespace("auth")("access_token"),n=a.namespace("auth")("refresh_token");t&&n&&(o+=`&access_token=${t}&refresh_token=${n}`)}return e?e.src!==o&&(e.src=o):(u("getIframe","Load Iframe",o),e=document.createElement("IFRAME"),e.src=o,e.id=d,e.style.border="none",e.style.position="absolute",e.style.top=c-1+"px",e.style.right="60px",e.style.width="1px",e.style.height="1px",e.style.zIndex="99",e.style.backgroundColor="transparent",e.setAttribute("allow","payment; clipboard-read; clipboard-write"),document.body.appendChild(e),window.addEventListener("message",t=>{if(t.origin===r){const{action:n,data:l}=t.data;switch(n){case"close":f();break;case"resize":(l.width??0)>1&&(l.height??0)>1&&(e.style.width=l.width+"px",e.style.height=l.height+"px");break;case"ready":e.setAttribute("readyToReceiveMessages","true");const g=a.namespace("iframeMessages"),y=g("messages")||[];for(const k of y)x(k);g("messages",null);break}}}),window.addEventListener("scroll",()=>{c=window.scrollY,e.style.top=c+"px"})),p?(e.style.width="360px",e.style.height="600px"):p!==void 0&&f(),e};var L=I;export{L as default};
