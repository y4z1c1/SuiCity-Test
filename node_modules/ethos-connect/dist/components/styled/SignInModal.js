import t,{useCallback as S,useEffect as p,useMemo as h,useState as l}from"react";import et from"../svg/Loader.js";import L from"../svg/WalletsIcon.js";import*as u from"./signInModalStyles.js";import ot from"../../lib/useHandleElementWithIdClicked.js";import lt from"./EmailSent.js";import nt from"./Wallets.js";import _ from"./Email.js";import it from"./Dialog.js";import st from"./ModalWrapper.js";import at from"./InstallWallet.js";import M from"./IconButton.js";import b from"../../hooks/hooks.js";import rt from"./MobileWallet.js";import P from"./Header.js";import T from"./Or.js";import Y from"../../lib/log.js";function Et(){window.ethosInternal.showSignInModal()}function xt(){window.ethosInternal.hideSignInModal()}const dt=({connectMessage:g,dappName:$,dappIcon:y,hideEmailSignIn:a,hideWalletSignIn:r,externalContext:C,preferredWallets:i})=>{const{wallets:O,selectWallet:j}=C?.wallet||b.useWallet(),{isModalOpen:w,openModal:k,closeModal:d}=C?.modal||b.useModal(),[E,x]=l(w),[q,v]=l(!1),[z,D]=l(!1),{width:o}=b.useWindowDimensions(),H="ethos-close-on-click",[N,A]=l(!1),[m,G]=l(!1),[f,B]=l(!1),[n,J]=l($),[s,K]=l();ot(H,d),p(()=>{window.ethosInternal||(window.ethosInternal={}),window.ethosInternal.showSignInModal=()=>{k()},window.ethosInternal.hideSignInModal=()=>{d()},x(w)},[w,x,k,d]),p(()=>{if(a&&r)throw new Error("hideEmailSignIn and hideWalletSignIn cannot both be true")},[a,r]),p(()=>{n||J(document.title)},[n]),p(()=>{let e=O||[];i&&i.length>0&&(e=e.sort((R,tt)=>{let c=i.indexOf(R.name);c===-1&&(c=e.length);let W=i.indexOf(tt.name);return W===-1&&(W=e.length),c-W})),Y("preferredWallets",i,e),K(e)},[O,i,Y]);const Q=S(()=>{B(e=>!e)},[]),F=S(()=>{A(e=>!e)},[]),U=S(()=>{B(!1),G(!1),A(!1)},[]),I=h(()=>g||(n?t.createElement(t.Fragment,null,"Connect to ",t.createElement("span",{style:u.highlighted()},n)):t.createElement(t.Fragment,null)),[n,g]),V=h(()=>s?m?t.createElement(rt,null):f||a&&s.length===0?t.createElement(at,{width:o}):r?t.createElement(_,{setSigningIn:v,setEmailSent:D,width:o}):!N&&s.length>0?t.createElement(P,{title:I,dappIcon:y,subTitle:"Choose from your installed wallets"},t.createElement(nt,{wallets:s,selectWallet:j,width:o}),!a&&t.createElement(t.Fragment,null,t.createElement(T,null),t.createElement("div",{style:u.submitButtonContainer()},t.createElement(M,{text:"Sign In With Email",onClick:F,width:o,primary:!0})))):t.createElement(P,{title:I,dappIcon:y,subTitle:`Log in to ${n}`},t.createElement(_,{setSigningIn:v,setEmailSent:D,width:o}),!r&&t.createElement(t.Fragment,null,t.createElement(T,null),t.createElement("div",{style:u.submitButtonContainer()},s.length>0?t.createElement(M,{icon:t.createElement(L,null),text:"Select One Of Your Wallets",onClick:F,width:o}):t.createElement(M,{icon:t.createElement(L,null),text:"Install A Wallet",onClick:Q,width:o})))):t.createElement(t.Fragment,null),[I,n,a,r,s,N,m,f]),X=h(()=>m||f,[m,f]),Z=h(()=>t.createElement("div",{style:u.loaderStyle()},t.createElement(et,{width:50})),[]);return t.createElement(it,{isOpenAll:E},t.createElement(st,{closeOnClickId:H,onClose:d,isOpenAll:E,width:o,back:X?U:null},z?t.createElement(lt,null):q?Z:V))};var vt=dt;export{vt as default,xt as hideSignInModal,Et as showSignInModal};
