function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},e.apply(this,arguments)}var t=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,o,u;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(o=r;0!=o--;)if(!e(t[o],n[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(u=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(o=r;0!=o--;)if(!Object.prototype.hasOwnProperty.call(n,u[o]))return!1;for(o=r;0!=o--;){var i=u[o];if(!e(t[i],n[i]))return!1}return!0}return t!=t&&n!=n};function n(n){let r,o=n,u=[],i=[],f=[];const c=e({},{draft:function(){return r},sketch:function(e,n){var u;const i=r,f=l(null!=(u=r)?u:o,e);return t(i,f)||(p({eventType:"before:sketch"}),r=f,p({eventType:"after:sketch"}),null!=n&&n.silent||y()),c},publish:function(e){if(void 0===r)return c;const n=r;return t(o,n)||(p({eventType:"before:publish"}),a(n),p({eventType:"after:publish"}),s(),null!=e&&e.silent||v()),c},discard:s},{set:function(e,n){if(void 0===e&&void 0===r)return c;const u=o,i=l(o,e);return t(u,i)||(p({eventType:"before:set"}),a(i),p({eventType:"after:set"}),null!=n&&n.silent||v()),c},now:function(){return o},subscribe:function(e,t){if("draft"===t)return function(e){const t=i.length;return i.push(e),()=>i=[...i.slice(0,t),...i.slice(t+1,i.length)]}(e);const n=u.length;return u.push(e),()=>u=[...u.slice(0,n),...u.slice(n+1,u.length)]},extend:function(t){return e({},c,function(t){return Object.keys(t).reduce((n,r)=>e({},n,{[r]:(...e)=>{const n=t[r](c,...e);if(void 0!==n)return n}}),{})}(t))},use:function(e){return p({eventType:"init"},e),f=[...f,...e],c},unsubscribeAll:function(){u=[],i=[]}});function s(e){return void 0===r||(p({eventType:"before:discard"}),r=void 0,p({eventType:"after:discard"}),null!=e&&e.silent||y()),c}function a(e){p({eventType:"before:change"}),o=e,p({eventType:"after:change"})}function l(e,t){const n=function(e){if(void 0!==e)return e instanceof Map?new Map(e):e instanceof Set?new Set(e):JSON.parse(JSON.stringify(e))}(e);return function(e){return"function"==typeof e}(t)?t(n):t}function p({eventType:t},n){const r=n||f;r.length&&r.forEach(n=>{n(e({eventType:t},c))})}function v(){p({eventType:"before:broadcast:now"}),u.forEach(e=>e(o)),p({eventType:"after:broadcast:now"})}function y(){p({eventType:"before:broadcast:draft"}),i.forEach(e=>e(r)),p({eventType:"after:broadcast:draft"})}return c}export{n as superstate};
