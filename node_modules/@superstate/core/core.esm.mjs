function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},e.apply(this,arguments)}var t=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,o,u;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(o=r;0!=o--;)if(!e(t[o],n[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(u=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(o=r;0!=o--;)if(!Object.prototype.hasOwnProperty.call(n,u[o]))return!1;for(o=r;0!=o--;){var i=u[o];if(!e(t[i],n[i]))return!1}return!0}return t!=t&&n!=n};function n(n){var r=n,o=void 0,u=[],i=[],c=[],f=e({},{draft:function(){return o},sketch:function(e,n){var u,i=o,c=l(null!=(u=o)?u:r,e);return t(i,c)||(v({eventType:"before:sketch"}),o=c,v({eventType:"after:sketch"}),null!=n&&n.silent||b()),f},publish:function(e){if(void 0===o)return f;var n=o;return t(r,n)||(v({eventType:"before:publish"}),s(n),v({eventType:"after:publish"}),a(),null!=e&&e.silent||y()),f},discard:a},{set:function(e,n){if(void 0===e&&void 0===o)return f;var u=r,i=l(r,e);return t(u,i)||(v({eventType:"before:set"}),s(i),v({eventType:"after:set"}),null!=n&&n.silent||y()),f},now:function(){return r},subscribe:function(e,t){if("draft"===t)return function(e){var t=i.length;return i.push(e),function(){return i=[].concat(i.slice(0,t),i.slice(t+1,i.length))}}(e);var n=u.length;return u.push(e),function(){return u=[].concat(u.slice(0,n),u.slice(n+1,u.length))}},extend:function(t){return e({},f,function(t){return Object.keys(t).reduce(function(n,r){var o;return e({},n,((o={})[r]=function(){var e=t[r].apply(t,[p()].concat([].slice.call(arguments)));if(void 0!==e)return e},o))},{})}(t))},use:function(e){return v({eventType:"init"},e),c=[].concat(c,e),f},unsubscribeAll:function(){u=[],i=[]}});function a(e){return void 0===o||(v({eventType:"before:discard"}),o=void 0,v({eventType:"after:discard"}),null!=e&&e.silent||b()),f}function s(e){v({eventType:"before:change"}),r=e,v({eventType:"after:change"})}function l(e,t){var n=function(e){if(void 0!==e)return e instanceof Map?new Map(e):e instanceof Set?new Set(e):JSON.parse(JSON.stringify(e))}(e);return function(e){return"function"==typeof e}(t)?t(n):t}function v(t,n){var r=t.eventType,o=n||c;o.length&&o.forEach(function(t){t(e({eventType:r},f))})}function p(){return f}function y(){v({eventType:"before:broadcast:now"}),u.forEach(function(e){return e(r)}),v({eventType:"after:broadcast:now"})}function b(){v({eventType:"before:broadcast:draft"}),i.forEach(function(e){return e(o)}),v({eventType:"after:broadcast:draft"})}return f}export{n as superstate};
